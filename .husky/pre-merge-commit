#!/bin/bash
# Get the current branch
current_branch=$(git rev-parse --abbrev-ref HEAD)

# List of protected files (can be moved to a separate config file)
protected_patterns=$(git config --get-all merge.keep-ours.driver | while read -r line; do
  git check-attr merge -- * | grep "merge: keep-ours" | cut -d: -f1
done)

# Check each changed file
changed_files=$(git diff --name-only ORIG_HEAD HEAD)
for file in $changed_files; do
  if echo "$protected_patterns" | grep -q "^${file}$"; then
    if ! git diff --quiet ORIG_HEAD HEAD -- "$file"; then
      echo "Notice: Protected file $file keeping current branch version"
      git checkout HEAD -- "$file"
    fi
  fi
done

exit 0
